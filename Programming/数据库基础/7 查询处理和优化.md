## 一  知识结构

#### 1  查询处理概述

1.1  查询处理过程
1.2  查询代价度量

#### 2  关系代数运算的执行

2.1  选择运算
	2.1.1  线性扫描
	2.1.2  索引扫描
	2.1.3  索引比较
2.2  连接运算
	2.2.1  嵌套循环连接
	2.2.2  块嵌套循环连接
	2.2.3  索引嵌套循环连接
	2.2.4  归并连接
	2.2.5  散列连接
		2.2.5.1  基本思路
		2.2.5.2  关系划分
		2.2.5.3  代价分析
2.3  表达式计算
	2.3.1  物化
	2.3.2  流水线

#### 3  查询优化

3.1  查询优化概述
3.2  关系表达式的转换
	3.2.1  等价规则
3.3  估计代价
	3.3.1  统计信息计算和维护
	3.3.2  选择运算估计
	3.3.3  连接运算估计
3.4  选择执行计划
	3.4.1  基于代价的优化
	3.4.2  启发式优化
	3.4.3  其它优化技术

## 二  主要内容

​	查询处理是指从数据库中提取数据时的一系列活动。查询处理过程主要有：语法分析、查询优化、计划执行。为了进行查询优化，需要度量不同等价关系表达式的代价，主要度量标准是磁盘存取开销，即磁盘搜索次数和传送磁盘块数。

​	关系代数运算可以以不同的方式执行，对于每种执行方式都要度量它的代价。
​	执行选择运算时，可以线性扫描，也可以使用索引扫描。主索引扫描的开销很低，辅助索引扫描一般也能降低开销，但也有可能比线性扫描开销更大。扫描若在一个范围内进行，一般使用主索引扫描。
​	执行连接运算时，最简单的方式是嵌套循环连接和块嵌套循环连接，后者是对前者的改进。如果有索引，也可以执行索引嵌套循环连接，它能明显改进性能。一种好的方式是归并连接，它先对连接的关系排序再顺序地扫描关系一次。另一种好的方式是散列连接，它将两个关系划分为不同的散列集，再将对应散列集中的元组连接。如果内存空间不够，还需要递归连接。对散列连接的代价分析是复杂的。
​	计算整个关系表达式可以有物化方式和流水线方式两种。物化方式每个步骤执行一个运算，并把当前结果存储在磁盘上，因而开销很大。流水线方式将多个运算甚至所有运算组合成流水线，中间结果的元组被连续地计算，因而不需要保存中间关系。流水线方式有需求驱动和生产者驱动两种方式。

​	查询优化的任务是产生一个查询执行计划，该查询执行计划能获得与原关系表达式的查询执行计划相同的结果，并且执行代价尽可能地小。查询优化分为三步：产生等价表达式、产生查询执行计划并估计代价、选择最优查询执行计划。
​	转换关系表达式的主要依据是关系代数，等价转换通过一系列等价规则进行。
​	估计代价需要计算和维护一些统计数据，并根据不精确的统计数据和不严密的假设得到近似的估计结果。对选择运算和连接运算各有一套估计方法。
​	选择执行计划时，可以基于代价优化，需要用到动态规划技术；也可以启发式地优化，直接应用一些启发式规则。还有一些其它的优化方法。

## 三  重点梳理

- 理解并掌握查询处理过程，理解并掌握如何度量查询代价，理解并掌握查询优化过程。
- 理解并掌握选择运算的执行方式以及各执行方式的代价度量。
- 理解并掌握连接运算的执行方式以及各执行方式的代价度量。
- 理解并掌握散列连接的执行方式以及代价度量。
- 理解表达式计算，理解物化方式和流水线方式。
- 理解并掌握如何使用等价规则转换关系表达式。
- 理解并掌握如何根据统计信息估计代价。
- 理解并掌握如何选择最优查询执行计划。

## 四  难点解析

#### 1  查询处理过程是怎样的？简述过程。

#### 2  如何度量查询代价？

#### 3  如何执行选择运算？各执行方式的代价如何度量？

#### 4  如何执行连接运算？各执行方式的代价如何度量？

#### 5  如何执行散列连接？如何度量其执行代价？

#### 6  如何执行表达式计算？重点解释流水线方式。

#### 7  如何进行查询优化？简述过程。

#### 8  如何计算和维护统计信息？如何根据统计信息估计选择运算和连接运算的代价？

#### 9  如何选择最优查询执行计划？有哪些优化方法和优化技术？

## 五  重要图表

- **P280  查询处理过程**
  ![查询处理过程](D:\Learn\Note\Programming\数据库基础\Image\7 查询处理和优化\查询处理过程.png)
- **P283  选择运算代价度量**
  ![选择运算代价度量](D:\Learn\Note\Programming\数据库基础\Image\7 查询处理和优化\选择运算代价度量.png)
- P284  嵌套循环连接
  ![嵌套循环连接](D:\Learn\Note\Programming\数据库基础\Image\7 查询处理和优化\嵌套循环连接.png)
- P285  块嵌套循环连接
  ![块嵌套循环连接](D:\Learn\Note\Programming\数据库基础\Image\7 查询处理和优化\块嵌套循环连接.png)
- **P287  归并连接**
  ![归并连接](D:\Learn\Note\Programming\数据库基础\Image\7 查询处理和优化\归并连接.png)
- **P289  散列连接**
  ![散列连接](D:\Learn\Note\Programming\数据库基础\Image\7 查询处理和优化\散列连接.png)
- P293  等价关系表达式
  ![等价关系表达式](D:\Learn\Note\Programming\数据库基础\Image\7 查询处理和优化\等价关系表达式.png)
- P293  查询执行计划示例
  ![查询执行计划示例](D:\Learn\Note\Programming\数据库基础\Image\7 查询处理和优化\查询执行计划示例.png)

## 六  薄弱点清单



------

