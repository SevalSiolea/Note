## 一  知识结构

#### 1  事务

1.1  事务的概念
	1.1.1  事务的ACID特性
	1.1.2  银行事务示例
	1.1.3  保证ACID特性的基本思路
1.2  原子性和持久性
	1.2.1  事务状态
	1.2.2  可见的外部写
1.3  隔离性
	1.3.1  并发的优势
	1.3.2  调度
1.4  可串行化
	1.4.1  读写指令
	1.4.2  冲突等价调度
1.5  可恢复性
	1.5.1  可恢复调度
	1.5.2  无级联调度
	1.5.3  事务隔离级别

#### 2  并发控制

2.1  基于锁的协议
	2.1.1  共享锁和排它锁
	2.1.2  加锁和解锁
	2.1.3  两阶段封锁协议
	2.1.4  多粒度两阶段封锁协议
		2.1.4.1  意向锁
2.2  基于时间戳的协议
	2.2.1  时间戳排序协议
	2.2.2  有效性检查协议

#### 3  恢复系统

3.1  故障类型
3.2  访问和修改数据
	3.2.1  数据访问
	3.2.2  暂存修改
	3.2.3  数据库修改
3.3  并发控制和恢复
3.4  使用日志的恢复技术
	3.4.1  日志记录
3.5  检查点

## 二  主要内容

​	事务是一系列操作的集合，具有ACID特性，数据库系统保证事务的正确执行。原子性要求事务的所有操作要么都执行要么都不执行，而持久性则要求事务完成后其在数据库中的影响持久保留；恢复系统通过对事务的回滚和重做保证原子性和持久性。隔离性要求并发事务的执行不会互相影响，这是并发管理器的工作。一致性要求事务执行前后数据库的状态一致，一致性由事务定义者定义并由数据库保证。
​	为保证事务的原子性和持久性，事务在执行过程中有一系列状态，并且在提交状态和中止状态才能结束。处理可见的外部写是一大难题。
​	并发事务尽管很难管理，但它优势很大。并发事务需要调度以保证其隔离性。调度并发事务时可以只考虑其读写指令。如果一个调度可以冲突等价于另一个串行调度，则称该调度是可串行化的；本章的大部分调度协议都是可串行化协议。有的事务还要求可恢复调度和无级联调度。有的数据库规定了事务隔离级别，允许不精确的事务拥有更低的隔离级别。

​	并发控制有两个基本思路：基于锁的协议和基于时间戳的协议。
​	基于锁的协议使用共享锁和排它锁作为基本的锁，事务访问共享数据项时需要加锁和解锁。两阶段封锁协议将事务的执行分为两个阶段，在增长阶段只能加锁不能解锁，在缩减阶段只能解锁不能加锁，对封锁点排序给出了一个可串行化调度。多粒度两阶段封锁协议将数据项分为不同的粒度级别，允许使用意向锁对一个粒度节点加锁，从而节省了加锁和解锁的开销。
​	基于时间戳的协议为每一个事务分配一个时间戳，并保证事务按照时间戳的顺序执行。时间戳排序协议是基本的协议。有效性检查协议作出了进一步改进，在共享读阶段减少了开销。

​	恢复系统负责将中止事务撤销和将提交事务重做，以保证事务的原子性和一致性。首先讨论了故障类型，恢复系统只能从某些类型的故障中恢复。恢复系统主要使用日志作为恢复技术，其基本思路是：事务对数据库作出修改前，要将其所作修改提交到日志上。如果一个事务的所有修改都提交到日志上，恢复系统就认为这个事务已经提交，从而可以重做该事务的所有修改；否则，恢复系统只能认为该事务中止，从而通过覆盖旧值撤销该事务。检查点标记已经重做或撤销的日志部分，从而减少了时间和空间的开销。

## 三  重点梳理

- 理解事务的概念，理解事务的ACID特性，理解并掌握保证ACID特性的基本思路。
- 理解事务调度，理解冲突等价调度和可串行化调度。
- 理解共享锁和排它锁，理解并掌握如何加锁和解锁。
- 理解并掌握两阶段封锁协议，理解并掌握多粒度两阶段封锁协议，理解并掌握意向锁。
- 理解并掌握时间戳排序协议和有效性检查协议。
- 理解并掌握使用日志的恢复技术，理解并掌握检查点。

## 四  难点解析

#### 1  什么是事务？事务的ACID特性是怎样的？如何保证事务的ACID特性？

#### 2  事务有哪些状态？事务如何进行状态转换？

#### 3  如何调度事务？什么是冲突等价调度和可串行化调度？

#### 4  什么是锁？如何加锁和解锁？

#### 5  两阶段封锁协议如何调度并发事务？

#### 6  多粒度两阶段封锁协议如何调度并发事务？如何使用意向锁？

#### 7  时间戳排序协议如何调度并发事务？

#### 8  有效性检查协议如何调度并发事务？

#### 9  数据如何修改数据库？

#### 10  什么是日志？如何使用日志恢复数据库？如何使用检查点？

## 五  重要图表

- P311  事务状态图
  ![事务状态图](D:\Learn\Note\Programming\数据库基础\Image\8 事务管理\事务状态图.png)
- P314 & P315  调度示例
  ![调度示例_1](D:\Learn\Note\Programming\数据库基础\Image\8 事务管理\调度示例_1.png)
  ![调度示例_2](D:\Learn\Note\Programming\数据库基础\Image\8 事务管理\调度示例_2.png)
- **P318  基于锁的调度示例**
  ![基于锁的调度示例](D:\Learn\Note\Programming\数据库基础\Image\8 事务管理\基于锁的调度示例.png)
- P321  粒度层次图
  ![粒度层次图](D:\Learn\Note\Programming\数据库基础\Image\8 事务管理\粒度层次图.png)
- P321  意向锁相容性矩阵
  ![意向锁相容矩阵](D:\Learn\Note\Programming\数据库基础\Image\8 事务管理\意向锁相容矩阵.png)

## 六  薄弱点清单



------

