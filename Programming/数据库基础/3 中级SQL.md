## 一  知识结构

#### 1  连接运算

1.1  连接条件 `on`
1.2  外连接
1.3  连接类型和条件

#### 2  视图

2.1  视图的作用
2.2  视图定义
2.3  查询使用视图
2.4  物化视图
2.5  视图更新
	2.5.1  可更新的视图

#### 3  事务

#### 4  完整性约束

4.1  单个关系的约束
	4.1.1  非空约束
	4.1.2  超码约束
	4.1.3  `check` 子句
4.2  参照完整性
	4.2.1  级联操作
4.3  事务约束
4.4  断言

#### 5  复杂数据类型

5.1  日期和时间
5.2  默认值
5.3  索引
5.4  大对象类型
5.5  用户定义类型
	5.5.1  域类型
5.6  创建表扩展

#### 6  目录和模式

#### 7  授权

7.1  权限授予和收回
7.2  角色
7.3  模式授权
7.4  级联授权

## 二  主要内容

​	本章介绍一些SQL的进阶语法：连接运算、视图、事务、完整性约束、复杂数据类型、目录和模式、授权。

​	在之前已经学习过自然连接运算。连接条件`on`用于指定连接时的条件，与`where`子句的作用类似；但`on`子句更加清晰，并且可用于外连接。外连接是这样的连接运算：不符合连接条件的元组可以通过补充空值加入到连接结果中。可以使用左外连接、右外连接和全外连接运算。已经学习过的连接类型和条件可以任意地组合。

​	视图适用于考虑安全或更加直观的情况。视图是一种虚关系，并不真正查询并存储关系，而是需要视图时再执行与视图关联的查询语句并得到视图。可以定义视图，但视图只在使用时才被创建；使用视图时，视图可以被放置在任何需要关系的地方。实际存储并被经常维护的视图被称为物化视图，物化视图的状态维护和开销权衡是其难点。由于从视图更新关系非常困难，一般不允许更新视图；即使可更新的视图也可能会产生问题。

​	之前已经学习过几种简单的完整性约束：主码约束、外码约束、非空约束。单个关系上的约束还可以有超码约束和`check`子句，后者因为过于复杂而几乎没有实现。参照完整性约束是比外码约束更一般的约束，它要求一个关系的属性值在另一个关系的属性值的集合中出现。违背参照完整性的操作默认不被允许，但也可以显式地指明级联操作。事务的完整性约束检查可以被延迟到事务结束时。可以用断言表达复杂`check`子句，但几乎没有实现支持断言。

​	SQL还支持一些复杂数据类型，例如日期和时间类型和大对象类型。可以为属性指定默认值。可以在一个或一组属性上创建索引，以支持数据库的快速查询。用户也可以自定义类型，自定义类型是强类型，可以避免错误的数据修改；域类型是过去支持的类型，但它的作用不大。SQL还提供了创建表的扩展，可以创建与现有表的模式相同的表，也可以从查询结果创建表。

​	SQL把数据库定为三级结构：目录、模式、关系。每一位用户都有自己的默认目录与模式，使用关系时需要指定完整的三级关系名，但默认目录和默认模式可以略去不写。

​	可以为不同用户授予不同数据的不同权限。用`grant`语句授予权限，用`revoke`语句收回权限。可以创建角色，并为角色授予权限；被授予角色的用户自动拥有这个角色的所有权限。不能为模式授予权限，但可以授予`references`权限。权限可以级联地授予和收回，非级联授予和级联收回是默认的。

## 三  重点梳理

- 理解并掌握连接运算，理解并掌握各种连接类型和连接条件。
- 理解并掌握视图，理解视图的作用，理解并掌握视图的定义、使用、更新。
- 理解并掌握完整性约束。
- 理解并掌握授权，理解角色，理解级联授权。

## 四  难点解析

#### 1  如何进行连接运算？有哪些连接类型和连接条件？它们如何组合？连接条件`on`有什么作用？

#### 2  视图有什么作用？物化视图如何维护？如何更新视图？

#### 3  如何进行级联操作以保持参照完整性？

#### 4  用户如何使用自定义类型？

#### 5  如何使用角色授权？如何授予`references`权限？如何级联授权？

## 五  重要图表

- **P69  连接类型和条件**
  ![连接类型和条件](D:\Learn\Note\Programming\数据库基础\Image\3 中级SQL\连接类型和条件.png)
- P85  级联授权图
  ![级联授权图](D:\Learn\Note\Programming\数据库基础\Image\3 中级SQL\级联授权图.png)

## 六  薄弱点清单



------

